<br>

<div class="row">

  <div class="span5">

    <div id="outer-video-box" class="video-container">
      <div id="title-box"><h3><%= @video.title %></h3></div>
      <div id="new-video-box"></div>
      <div id="timer-box"></div>
      <div id="settings"></div>
      <div id='notes-box'>
        <% if @note.present? %>
          <p id='note'>
            <% if action_name == 'edit' %>
              <strong>Your note: &nbsp;</strong>
            <% end %>
            <% if action_name == 'show' %>
              <strong>Note: &nbsp;</strong>
            <% end %>
            <span id='note-text'><%= @note %></span>
          </p>
        <% end %>
        <% if action_name == 'show' %>
          <p id='translator-name'><i>Translation by <%= link_to "#{@translator.username}", user_url(@translator) %>.</i></p>
        <% end %>
        <% if action_name == 'show' %>
          <div class='show-button-suite'>
            <% if current_user && @translator.id == current_user.id %>
              <div class='btn btn-info btn-small btn-tiny rounded' id='edit' style='float: right;'> edit </div>
            <% end %>
            <div class='btn btn-info btn-small btn-tiny rounded' id='controls-toggle' style='float: right;'> hide controls </div>
          </div>
        <% end %>
        <% if action_name == 'edit' || action_name == 'new' %>
          <div class='edit-button-suite'>
            <p><i>Teaching / translating tools:</i></p>
            <div class='btn btn-info btn-small btn-tiny rounded' id='word-marking-mode'> mark key words </div>
            <% if @note.blank? %>
              <div class='btn btn-info btn-small btn-tiny rounded' id='add-note'> add explanation </div>
            <% else %>
              <div class='btn btn-info btn-small btn-tiny rounded' id='edit-note'> edit note </div>
            <% end %>
            <div class='btn btn-info btn-small btn-tiny rounded' id='instructions-button'> editing tips </div>
          </div>
        <% end %>
        <% if @comments.present? %>
          <div class='btn btn-info btn-small btn-tiny rounded' id='comments-toggle' style='float: right;'> show comments </div>
        <% end %>
      </div>
    </div>
  </div> 

  <% if action_name == 'new' %>
    <div class="span5 offset2">
      <div id="controls"></div>
    </div>
  <% end %>

  <div class="span5 offset2">

  <% if @clip.blank? %>
    <div id="lyrics-box">
      <% @lines.each do |l| %>
        <div class="line rounded" data-time=<%= l.time %> data-duration=<%= l.duration %> id=<%= l.id %>>
          <% if l.lang1.present? %>
            <div class="lyrics-container">
              <p><%= l.lang1 %></p>
            </div>
          <% end %>
          <% if l.lang2.present? %> 
            <div class="lyrics-container">
              <p><%= l.lang2 %></p>
            </div>
          <% end %>
          <% if @comments.present? %>
            <% @comments.each do |comments| %>
              <% if comments[l.id].present? %>
                <% comments[l.id].each do |c| %>
                  <div class="comment">
                    <span class="comment-text"><%= User.find_by_id(c.user_id).username %>: <%= c.comment_text %></span>
                  </div>
                <% end %>
              <% end %>
            <% end %>
          <% end %>
        </div>
      <% end %>
    </div>
  <% else %>
    <div class="lyrics-container wide" id="lyrics-box">
      <% @lines_within_clip.each do |l| %>
        <div class="line rounded" data-time=<%= l.time %> data-duration=<%= l.duration %> <%= l.id %>>
          <% if l.lang1.present? %>
            <div class="lyrics-container">
              <p><%= l.lang1 %></p>
            </div>
          <% end %>
          <% if l.lang2.present? %> 
            <div class="lyrics-container">
              <p><%= l.lang2 %></p>
            </div>
          <% end %>
        </div>
      <% end %>
    </div>
    <% unless current_user %>
      <div class="share-clip-container">
        <p class="center"><i>Click <a href="/interpretations/<%= @interp.id %>">here</a> for the full translation.</i></p>
      </div>
    <% else %>
      <div class="share-clip-container">
        <h3 style="text-align: center;">Share this clip?</h3>
        <div class="btn btn-primary btn-share rounded" id="tweet-it" style="text-align: center;"> <i class="icon-twitter icon-2x"></i> </div>
        <div class="btn btn-primary btn-share rounded" id="email" style="text-align: center;"> <i class="icon-envelope icon-2x"></i> </div>
      </div>
    <% end %>
  </div>
  <% end %>

  <% if action_name == "edit" || action_name == "new" %>

    <div class="input-line-container">
      <div class="input-line">
        <div id="lang1-input">
          <i class='left'><%= @lang1 %>&nbsp;</i>
          <span class='loop-handle-label example current-loop-start'></span> to <span class='loop-handle-label example current-loop-end'></span> 
          <div class='control-group'>
            <div class='controls'>
              <input type='text' class='input-xlarge lang1-line'>
            </div>
          </div>
        </div>
      </div>
      <div class="input-line">
        <div id="lang2-input">
          <i class='left'><%= @lang2 %>&nbsp;</i>
          <span class='loop-handle-label example current-loop-start'></span> to <span class='loop-handle-label example current-loop-end'></span> 
          <div class='control-group'>
            <div class='controls'>
              <input type='text' class='input-xlarge lang2-line'>
            </div>
          </div>
        </div>
      </div>
    <div style="float: right; margin-top: 18px; margin-right: 8px;">
      <span class="btn btn-primary btn-small rounded tight-pack uniform-width" id="next-line"> Next line! </span>
      <br>
      <span class="btn btn-primary btn-small rounded tight-pack uniform-width" id="all-done"> All done. </span>
    </div>
  </div>

  <% end %>

</div>

<div id="data" class="quiet" 
  data-youtube-id=<%= @video.youtube_id %> 
  data-interp-id=<%= @interp.id %> 
  data-lang-one=<%= @video.lang1 %> 
  data-lang-two=<%= @interp.lang2 %> 
  data-translation-type=<%= if @lang1_and_lang2 then 'lang1_and_lang2' else 'just_lang2' end %> 
  data-action-name=<%= action_name %> 
  <% if @translator.present? %> 
    data-translator-name=<%= @translator.username %>
  <% end %>
  <% unless @quiz.present? %>
    <% if current_user %>
        data-current-user-username=<%= current_user.username %>
        <% if current_user.firstname.present? %>
          data-current-user-firstname=<%= current_user.firstname %>
        <% end %>
        data-current-user-id=<%= current_user.id %>
      <% unless current_user.id == @translator.id %>
        data-my-video='false'
      <% else %>
        data-my-video='true'
      <% end %>
    <% end %>
    <% else %>
    data-quiz-type="<%= @quiz.quiz_type %>"
    data-quiz-name="<%= @quiz.name %>"
    data-quiz-description="<%= @quiz.description %>"
    data-video-title="<%= @title %>"
  <% end %>
  <% if @clip.present? %>
  data-clip=<%= 'true' %>
  data-duration=<%= @duration %>
  data-start=<%= @start %>
  <% end %>
  data-published=<%= @published %>>
</div>